<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calibration</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <style>
        body {
            background-color: #FFFFFF;
            font-family: Arial, sans-serif;
        }
        nav {
            background-color: #000000;
            padding: 1rem;
        }
        nav ul {
            list-style-type: none;
            display: flex;
            justify-content: flex-end;
        }
        nav ul li {
            margin-left: 1rem;
        }
        nav ul li a {
            color: #FFFFFF;
            text-decoration: none;
        }
        .container {
            max-width: 800px;
            margin: 2rem auto;
            padding: 2rem;
            background-color: #F5F5F5;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }
        nav ul li.active a {
            color: #FFA500; /* Change to your preferred color */
            font-weight: bold;
        }
        .alert-success {
            background-color: #D4EDDA;
            color: #155724;
            border-color: #C3E6CB;
            padding: 10px;
            margin-bottom: 10px;
            border-radius: 5px;
        }
        .alert-error {
            background-color: #F8D7DA;
            color: #842029;
            border-color: #F5C6CB;
            padding: 10px;
            margin-bottom: 10px;
            border-radius: 5px;
        }

        svg {
            display: block;
            margin: 0 auto;
            background-color: #F5F5F5;
            border: 1px solid #000;
            border-radius: 5px;
        }

        .loader {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid #007bff;
            border-radius: 50%;
            border-top-color: transparent;
            animation: spin 0.6s linear infinite;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }
            100% {
                transform: rotate(360deg);
            }
        }
        #calibrate-btn {
            display: inline-flex;
            align-items: center;
        }

        .loader-container {
            display: inline-flex;
            align-items: center;
            height: 100%;
            margin-left: 10px;
        }
    </style>
</head>
<body>
    <div id="flash-messages">
        {% with messages = get_flashed_messages(with_categories=True) %}
            {% if messages %}
                {% for category, message in messages %}
                    <div class="alert {% if category == 'success' %}alert-success{% else %}alert-error{% endif %}" role="alert">
                        {{ message }}
                    </div>
                {% endfor %}
            {% endif %}
        {% endwith %}
    </div>    
    <nav>
        <ul>
            <li class="{{ 'active' if request.endpoint == 'home' }}"><a href="/">Home</a></li>
            <li class="{{ 'active' if request.endpoint == 'calibration' }}"><a href="/calibration">Calibration</a></li>
            <li class="{{ 'active' if request.endpoint == 'measure' }}"><a href="/measure">Measure Throw</a></li>
            <li class="{{ 'active' if request.endpoint == 'how_it_works' }}"><a href="/how-it-works">How does it work?</a></li>
            {% if current_user.is_authenticated %}
                <li><a href="{{ url_for('logout') }}">Logout</a></li>
            {% else %}
                <li><a href="{{ url_for('login', next=request.path) }}">Login</a></li>
            {% endif %}
        </ul>
    </nav>
    <div class="container">
        <h1>Calibration</h1>
        <p>Before you can accurately measure your dodgeball throws, you need to calibrate your camera setup. Calibration ensures that the measurements taken by our system are precise and tailored to your specific setup.</p>

        <h2>Calibration Process</h2>
        <p>Follow these steps to calibrate your camera setup:</p>
        <ol>
            <li>Position a calibration object (such as a ruler or tape measure) at the center of the throwing area, making sure it is clearly visible from both cameras.</li>
            <li>Record a short video of the calibration object from each camera, ensuring that the entire object is visible in the frame.</li>
            <li>Upload the calibration videos from each camera using the form below.</li>
            <li>After uploading the videos, our system will analyze the footage and calculate the necessary calibration parameters for your camera setup.</li>
        </ol>
        <p>Once calibration is complete, you can proceed to measure your dodgeball throws.</p>

        <h2>Upload Calibration Videos</h2>
        <form action="/calibration" method="POST" enctype="multipart/form-data">
            <div class="form-group">
                <label for="sideCamera">Side Camera:</label>
                <input type="file" class="form-control-file" id="sideCamera" name="sideCamera" required>
                <small class="form-text text-muted">Accepted formats: .mp4, .mov, .avi</small>
            </div>
            <div class="form-group">
                <label for="underneathCamera">Underneath Camera:</label>
                <input type="file" class="form-control-file" id="underneathCamera" name="underneathCamera" required>
                <small class="form-text text-muted">Accepted formats: .mp4, .mov, .avi</small>
            </div>
            <button type="submit" id="calibrate-btn">Calibrate</button>
        </form>
    </div>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const flashMessages = document.getElementById('flash-messages');
            const observer = new MutationObserver(function(mutations) {
                mutations.forEach(function(mutation) {
                    if (mutation.type === 'childList' && mutation.addedNodes.length > 0) {
                        while (mutation.target.firstElementChild !== mutation.addedNodes[0]) {
                            mutation.target.firstElementChild.remove();
                        }
                    }
                });
            });
    
            observer.observe(flashMessages, { childList: true });
        });
    </script>
    <script>
        const calibrateForm = document.querySelector('form[method="POST"]');
        const calibrateBtn = document.getElementById('calibrate-btn');
      
        calibrateForm.addEventListener('submit', function () {
          calibrateBtn.innerHTML = 'Calibrate <div class="loader-container"><div class="loader"></div></div>';
          calibrateBtn.disabled = true;
          //calibrateBtn.style.minWidth = '120px'; // Ensure the button doesn't shrink when the loader is added
        });
    </script>  
</body>
</html>
